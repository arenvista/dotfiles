#!/bin/bash

# 1. Get the list of sessions
# We use -F to get just the name.
sessions=$(tmux list-sessions -F "#{session_name}" 2>/dev/null)

# 2. Check if there are any sessions running
if [ -z "${sessions}" ]; then
    echo "No tmux session found, creating new session"
    tmux new-session
    exit 0
fi

# 3. Select session with fzf (Prepend with numbers)
# - awk '{print NR, $0}' adds the line number (1, 2, 3...)
# - fzf allows you to filter by that number or the name
selected_line=$(echo "$sessions" | awk '{print NR, $0}' | fzf --prompt="Select Tmux Session: " --height=40% --layout=reverse --border)

# 4. If the user selected something
if [ -n "${selected_line}" ]; then
    # Strip the number (and whitespace) from the selection to get just the session name
    # 'read' automatically assigns the first word to variable '_' (the number) and the rest to 'target'
    read -r _ target <<< "$selected_line"

    # Check if we are currently INSIDE a tmux session
    if [ -n "${TMUX}" ]; then
        # Inside: SWAP client to new session
        tmux switch-client -t "${target}"
    else
        # Outside: ATTACH to session
        tmux attach-session -t "${target}"
    fi
fi
